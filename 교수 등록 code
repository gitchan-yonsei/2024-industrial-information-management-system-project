-- 교수가 강의를 등록하는 프로세스

DELIMITER //

CREATE PROCEDURE RegisterCourse(
    IN p_name VARCHAR(200),          -- 강의 이름
    IN p_professor_id BIGINT,        -- 교수 ID
    IN p_classroom_id BIGINT,        -- 강의실 ID
    IN p_semester_id BIGINT,         -- 학기 ID
    IN p_max_students INT            -- 최대 학생 수
)
BEGIN
    -- 강의실 수용 가능 인원 확인
    DECLARE v_capacity INT;

    SELECT capacity 
    INTO v_capacity
    FROM Classrooms
    WHERE id = p_classroom_id;

    IF p_max_students > v_capacity THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Error: Max students exceed classroom capacity';
    END IF;

    -- 강의 등록
    INSERT INTO Courses (name, professor_id, classroom_id, semester_id, max_students)
    VALUES (p_name, p_professor_id, p_classroom_id, p_semester_id, p_max_students);
END //

DELIMITER ;
